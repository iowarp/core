# CTE Benchmark â€” SHM Transport
# Purpose: Measure CTE Put/Get performance over shared memory for 4KB, 16KB, and 1MB I/O sizes

config:
  name: cte_bench_shm
  pkgs:
    - pkg_type: jarvis_iowarp.wrp_runtime
      pkg_name: runtime
      do_dbg: false
      dbg_port: 4000
      log_level: "info"
      ipc_mode: "shm"
      stdout: $HOME/iowarp/core/build/cte.txt
      stderr: $HOME/iowarp/core/build/cte.txt

    - pkg_type: jarvis_iowarp.wrp_cte
      pkg_name: cte_core
      devices:
        - ["ram::cache", "500MB", 0.8]
        - ["/mnt/nvme/$USER/storage1.bin", "64g", 0.8]
      dpe_type: "max_bw"
      neighborhood: 4
      default_target_timeout_ms: 30000
      poll_period_ms: 5000

    - pkg_type: jarvis_iowarp.wrp_cte_bench
      pkg_name: cte_bench
      test_case: "PutGet"
      num_threads: 4
      depth: 4
      io_size: "4k"
      io_count: 100
      nprocs: 1
      ppn: 1

vars:
  cte_bench.io_size: ["4k", "16k", "1m"]
  cte_bench.ipc_mode: ["tcp", "ipc", "shm"]

loop:
  - [cte_bench.io_size]

repeat: 1

output: "${HOME}/cte_bench_shm_results"
