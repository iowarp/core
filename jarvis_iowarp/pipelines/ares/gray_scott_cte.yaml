# CTE Benchmark Example Pipeline
# Purpose: Demonstrate CTE core functionality with the CTE benchmark application
# Requirements: chimaera runtime start and chimaera runtime stop in PATH, wrp_cte_bench executable in PATH
config:
  name: gray_scott_cte

  env:
    OMPI_MCA_btl_tcp_if_include: enp47s0np0
  pkgs:
    - pkg_type: jarvis_iowarp.wrp_runtime
      pkg_name: runtime
      do_dbg: false
      dbg_port: 4000
      log_level: "info"
      ipc_mode: "tcp"
      stdout: $HOME/iowarp/core/build/cte.txt
      stderr: $HOME/iowarp/core/build/cte.txt

    - pkg_type: jarvis_iowarp.wrp_cte
      pkg_name: cte_core
      devices:
        - ["${HOME}/cte_benchmark/storage1.bin", "500MB", 0.8]
        - ["${HOME}/cte_benchmark/storage2.bin", "500MB", 0.7]

      # CTE Configuration Parameters
      dpe_type: "max_bw"                   # Data placement engine: random, round_robin, max_bw
      neighborhood: 4                      # Number of targets (nodes CTE can buffer to)
      default_target_timeout_ms: 30000     # Target timeout (ms)
      poll_period_ms: 5000                 # Period to rescan targets for statistics (capacity, bandwidth, etc.) (ms)

    - pkg_type: jarvis_iowarp.adios2_gray_scott
      pkg_name: gsbench
      L: 512
      nprocs: 64                           # Number of MPI processes
      ppn: 16                               # Processes per node
      out_file: "${HOME}/cte_gs/gsbench.bp"
      engine: "iowarp"

  # Environment configuration (optional)
  # env:
  #   WRP_CTE_LOG_LEVEL: "info"
  #   CTE_DEBUG: "0"
vars:
  gsbench.L: [512]

loop:
  - [gsbench.L]

repeat: 1

output: "${HOME}/gray_scott_cte"
