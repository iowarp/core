# Container Distributed Test Pipeline
# Launches IOWarp runtime and runs distributed bdev tests in Docker containers
# Uses hostfile at /etc/iowarp/hostfile for multi-node cluster

name: distributed_test_container

env:
  # Environment variables for container testing
  TEST_MODE: "container"
  CONTAINER_HOSTFILE: "/etc/iowarp/hostfile"

pkgs:
  # Stage 1: Launch IOWarp runtime on all nodes
  - pkg_type: jarvis_iowarp.wrp_runtime
    pkg_name: runtime
    num_threads: 8
    process_reaper_workers: 1
    main_segment_size: "auto"
    client_data_segment_size: "2G"
    port: 9413
    log_level: "info"
    queue_depth: 1024
    local_sched: "default"
    heartbeat_interval: 1000
    sleep: 5

  # Stage 2: Run distributed tests with 4 nodes
  - pkg_type: jarvis_iowarp.wrp_distributed
    pkg_name: distributed_test
    num_nodes: 4
    test_case: "all"
    output_dir: "/tmp/wrp_distributed_container"
    verbose: true
