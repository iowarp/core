# =============================================================================
# IOWarp Default Configuration
# =============================================================================
# Canonical reference for all configurable parameters across:
#   - Chimaera Runtime (context-runtime)
#   - Context Transfer Engine / CTE (context-transfer-engine)
#   - Context Assimilation Engine / CAE (context-assimilation-engine)
#
# Config lookup order:
#   1. CHI_SERVER_CONF environment variable
#   2. WRP_RUNTIME_CONF environment variable
#   3. ~/.chimaera/chimaera.yaml
#
# Size values accept: B, KB, MB, GB, TB (case-insensitive)
# =============================================================================

# -- Networking ---------------------------------------------------------------
networking:
  port: 5555                           # RPC listener port
  neighborhood_size: 32                # Max nodes queried when splitting range queries
  # hostfile: "/path/to/hostfile"      # One hostname per line for distributed mode
  wait_for_restart: 30                 # Seconds to wait for peer nodes on startup
  wait_for_restart_poll_period: 1      # Seconds between connection retries

# -- Logging ------------------------------------------------------------------
# Logging is controlled by environment variables, not this file.
#   HSHM_LOG_LEVEL : debug, info, success, warning, error, fatal (default: info)
#   HSHM_LOG_OUT   : path to a log file (default: console only)

# -- Runtime ------------------------------------------------------------------
runtime:
  num_threads: 4                       # Worker threads for task execution
  queue_depth: 1024                    # Task queue depth per worker
  local_sched: "default"               # Local task scheduler algorithm
  first_busy_wait: 10000               # Microseconds to busy-wait before sleeping (10ms)

# -- Compose ------------------------------------------------------------------
# Modules started automatically with the runtime.
# Only chimaera_bdev is required. CTE (wrp_cte_core) and CAE (wrp_cae_core)
# are optional — remove their entries if you do not need them.
compose:

  # === Block Device (DRAM) ===
  # Required: provides the shared memory allocator used by other modules.
  - mod_name: chimaera_bdev
    pool_name: "ram::chi_default_bdev"
    pool_query: local
    pool_id: "301.0"
    bdev_type: ram                       # "ram" for DRAM-backed block device
    capacity: "512MB"

  # === Block Device (File) ===
  # Uncomment to add a file-backed block device (e.g., for NVMe or HDD storage).
  # - mod_name: chimaera_bdev
  #   pool_name: "/mnt/nvme/chi_bdev"
  #   pool_query: local
  #   pool_id: "302.0"
  #   bdev_type: file                    # "file" for filesystem-backed block device
  #   capacity: "100GB"

  # === Context Transfer Engine (CTE) — optional ===
  # High-performance data buffering and transfer engine.
  # Remove this section if CTE is not needed.
  - mod_name: wrp_cte_core
    pool_name: cte_main
    pool_query: local
    pool_id: "512.0"

    # Storage tiers ---------------------------------------------------------
    # Each entry creates a block device for CTE to buffer data onto.
    # score: 0.0 = slowest/cheapest, 1.0 = fastest/most expensive
    #        -1.0 = automatic scoring
    storage:
      - path: "ram::cte_ram_tier1"       # "ram::<name>" for DRAM, filesystem path for disk
        bdev_type: "ram"                 # "ram" or "file"
        capacity_limit: "512MB"
        score: 1.0                       # DRAM = highest-performance tier

    # Data Placement Engine ------------------------------------------------
    dpe:
      dpe_type: "max_bw"                # "max_bw", "round_robin", or "random"

    # Target management ----------------------------------------------------
    targets:
      neighborhood: 1                   # Storage nodes CTE can buffer to
      default_target_timeout_ms: 30000   # Timeout for target operations (ms)
      poll_period_ms: 5000               # Target statistics re-scan interval (ms)

    # Performance tuning ---------------------------------------------------
    # Uncomment to override defaults:
    # performance:
    #   stat_targets_period_ms: 50       # Periodic StatTargets interval (ms)
    #   max_concurrent_operations: 64    # Max concurrent I/O operations
    #   score_threshold: 0.7             # Score above which blobs are reorganized
    #   score_difference_threshold: 0.05 # Min score delta to trigger reorganization
    #   flush_metadata_period_ms: 5000   # Metadata flush interval (ms)
    #   flush_data_period_ms: 10000      # Data flush interval (ms)
    #   flush_data_min_persistence: 1    # Min persistence level (1=temp-nonvolatile)
    #   transaction_log_capacity: "32MB" # Write-ahead log capacity

  # === Context Assimilation Engine (CAE) — optional ===
  # Data ingestion and assimilation engine.
  # Remove this section if CAE is not needed.
  - mod_name: wrp_cae_core
    pool_name: wrp_cae_core_pool
    pool_query: local
    pool_id: "400.0"
